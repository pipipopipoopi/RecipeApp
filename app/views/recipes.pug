extends layout

block content
  .container
      header
        h1 Recipes
        a.button(href='/') ← Back to search

      // show filter summary
      if path
        .filters
          strong Filters:
          |  #{Object.keys(query).length ? Object.entries(query).map(([k,v]) => `${k}=${Array.isArray(v)?v.join(','):v}`).join(' • ') : 'None (showing all recipes)'}

      section.recipes
        if recipes && recipes.length
          each recipe in recipes
            article.card(data-id=recipe.id)
              // favorite star
              button.fav-btn(type='button' title='Toggle favorite' data-id=recipe.id class=(locals.user && Array.isArray(locals.user.favorites) && locals.user.favorites.indexOf(recipe.id) !== -1 ? 'favorited' : ''))
                | ★
              
              article.card-body
                h2.card-title= recipe.title
                .meta
                if recipe.prepTime
                  span.badge Prep: #{recipe.prepTime}
                if recipe.cuisine
                  span.badge Cuisine: #{Array.isArray(recipe.cuisine) ? recipe.cuisine.join(', ') : recipe.cuisine}
                if recipe.mealType
                  span.badge Meal Type: #{Array.isArray(recipe.mealType) ? recipe.mealType.join(', ') : recipe.mealType}

              if recipe.ingredients
                p
                  strong Ingredients:
                  span.chips
                    each ing in recipe.ingredients
                      span.chip= ing

              if recipe.dietary
                p
                  strong Dietary:
                  span.diet
                    each d in (Array.isArray(recipe.dietary) ? recipe.dietary : [recipe.dietary])
                      span.badge= d

              if recipe.instructions
                details
                  summary Instructions
                  p= recipe.instructions
        else
          p.no-results No recipes found for that filter configuration.

block scripts
  script(src='/js/recipes.js')